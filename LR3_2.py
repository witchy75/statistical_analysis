import math
from scipy.stats import norm
import scipy.stats as stats
import numpy as np
import random

with open("ะะพัะบะฒะฐ_2021.txt", 'r') as f:
    a = list(map(int, f.read().split()))

average = sum(a)/len(a) # ััะตะดะฝะตะต ะทะฝะฐัะตะฝะธะต ะฟะพ ะฒัะตะน ัะพะฒะพะบัะฟะฝะพััะธ
sum_for_variance = 0
for i in range(len(a)):
    sum_for_variance += (a[i] - average)**2
variance = sum_for_variance / (len(a) - 1)  # ะฝะตัะผะตััะฝะฝะฐั ะดะธัะฟะตััะธั
asd = math.sqrt(variance)

accuracy = 3
t = 1.96
sample_size = math.ceil((t**2 * asd**2) / accuracy**2) # ะพะฑัะตะผ ะฒัะฑะพัะบะธ

sample1 = random.sample(a, sample_size)
sample2 = random.sample(a, sample_size)

# 2.1

# ะดะธัะฟะตััะธั ะฝะตัะผะตัะตะฝะฝะฐั
var1 = np.var(sample1, ddof=1) # ddof=1 -> ะดะตะปะธัะตะปั (n-1) -> ะฝะตัะผะตัะตะฝะฝะฐั ะดะธัะฟะตััะธั
var2 = np.var(sample2, ddof=1)

# F-ะฝะฐะฑะปัะดะฐะตะผะพะต (ะฑะตััะผ ะพัะฝะพัะตะฝะธะต ะฑะพะปััะตะน ะดะธัะฟะตััะธะธ ะบ ะผะตะฝััะตะน)
if var1 >= var2:
    F = var1 / var2
    # ััะตะฟะตะฝะธ ัะฒะพะฑะพะดั: df1 ะดะปั ัะธัะปะธัะตะปั (ะฑะพะปััะตะน ะดะธัะฟะตััะธะธ), df2 ะดะปั ะทะฝะฐะผะตะฝะฐัะตะปั (ะผะตะฝััะตะน ะดะธัะฟะตััะธะธ)
    df1 = sample_size - 1
    df2 = sample_size - 1
else:
    F = var2 / var1
    # ััะตะฟะตะฝะธ ัะฒะพะฑะพะดั: df1 ะดะปั ัะธัะปะธัะตะปั (ะฑะพะปััะตะน ะดะธัะฟะตััะธะธ), df2 ะดะปั ะทะฝะฐะผะตะฝะฐัะตะปั (ะผะตะฝััะตะน ะดะธัะฟะตััะธะธ)
    df1 = sample_size - 1
    df2 = sample_size - 1 

alpha = 0.05 # ััะพะฒะตะฝั ะทะฝะฐัะธะผะพััะธ - ะฒะตัะพััะฝะพััั ะพัะธะฑะบะธ I ัะพะดะฐ

# ะฟัะพะฒะตัะบะฐ H1: D1 > D2 (ะพะดะฝะพััะพัะพะฝะฝัั - ะฟัะฐะฒะพััะพัะพะฝะฝัั)
F_crit_one_sided = stats.f.ppf(1 - alpha, df1, df2) # ะัะธัะธัะตัะบะฐั ัะพัะบะฐ ๐นะบั(๐ผ; ๐1; ๐2)

print('1) ะัะพะฒะตัะธัั ะฝัะปะตะฒัั ะณะธะฟะพัะตะทั ะพ ัะฐะฒะตะฝััะฒะต ะดะธัะฟะตััะธะน ะณะตะฝะตัะฐะปัะฝัั ัะพะฒะพะบัะฟะฝะพััะตะน')
print("\nะัะพะฒะตัะบะฐ ะณะธะฟะพัะตะทั H1: D1 > D2")
print(f"Fะฝะฐะฑะป = {F:.4f}")
print(f"Fะบั = {F_crit_one_sided:.4f}")

# ะัะปะธ ะพัะฝะพัะตะฝะธะต ๐1/๐2 ะฑะพะปััะต ะบัะธัะธัะตัะบะพะน ัะพัะบะธ, ัะพ ะดะธัะฟะตััะธะธ ัะฐะทะปะธัะฐัััั ะผะตะถะดั ัะพะฑะพะน ั ะฒะตัะพััะฝะพัััั p = 1โฏโ ฮฑ

if F > F_crit_one_sided:
    print('Fะฝะฐะฑะป > Fะบัะธั')
    print("โ ะัะฒะตัะณะฐะตะผ H0: ะดะธัะฟะตััะธะธ ัะฐะทะปะธัะฐัััั (D1 > D2)")
else:
    print('Fะฝะฐะฑะป < Fะบัะธั')
    print("โ ะะต ะพัะฒะตัะณะฐะตะผ H0: ะดะธัะฟะตััะธะธ ัะฐะฒะฝั")

# ะฟัะพะฒะตัะบะฐ H1: D1 โ D2 (ะดะฒัััะพัะพะฝะฝัั)
# ะะปั ะฟัะพะฒะตัะบะธ ะณะธะฟะพัะตะทั ะ0 ะฟัะธ ะบะพะฝะบััะธััััะตะน ะณะธะฟะพัะตะทะต H1: D (X) โ D(Y)
# ะดะพััะฐัะพัะฝะพ ะฝะฐะนัะธ ะฟัะฐะฒัั ะบัะธัะธัะตัะบัั ัะพัะบั F2 = Fะบp (alpha/2; k1; k2).
F_lower = stats.f.ppf(alpha/2, df1, df2) # ะปะตะฒะฐั ะณัะฐะฝะธัะฐ ะบัะธัะธัะตัะบะพะน ะพะฑะปะฐััะธ
F_upper = stats.f.ppf(1 - alpha/2, df1, df2) # ะฟัะฐะฒะฐั

print("\nะัะพะฒะตัะบะฐ ะณะธะฟะพัะตะทั H1: D1 โ D2")
print(f"Fะฝะฐะฑะป = {F:.4f}")
print(f"ะัะธัะธัะตัะบะฐั ะพะฑะปะฐััั: F < {F_lower:.4f} ะธะปะธ F > {F_upper:.4f}")

if F < F_lower or F > F_upper:
    print('Fะฝะฐะฑะป < Fะฟัะฐะฒ ะธะปะธ Fะฝะฐะฑะป > Fะฒะตัั')
    print("โ ะัะฒะตัะณะฐะตะผ H0: ะดะธัะฟะตััะธะธ ัะฐะทะปะธัะฐัััั")
else:
    print('Fะฟัะฐะฒ < Fะฝะฐะฑะป < Fะฒะตัั')
    print("โ ะะต ะพัะฒะตัะณะฐะตะผ H0: ะดะธัะฟะตััะธะธ ัะฐะฒะฝั")

# ะัะฒะพะด ะดะธัะฟะตััะธะน ะดะปั ะพััััะฐ
print("\nะัะฑะพัะพัะฝะฐั ะดะธัะฟะตััะธั 1:", round(var1, 3))
print("ะัะฑะพัะพัะฝะฐั ะดะธัะฟะตััะธั 2:", round(var2, 3))


# 2.2
# ะัะพะฒะตัะบะฐ ะณะธะฟะพัะตะทั ะพ ัะฐะฒะตะฝััะฒะต ะดะธัะฟะตััะธะธ ะพะดะฝะพะน ะฒัะฑะพัะบะธ ะธ ะธะทะฒะตััะฝะพะณะพ ฯยฒ
print("\n2) ะัะพะฒะตัะบะฐ ะฝัะปะตะฒะพะน ะณะธะฟะพัะตะทั ะพ ัะฐะฒะตะฝััะฒะต ะณะตะฝะตัะฐะปัะฝะพะน ะดะธัะฟะตััะธะธ ะธ ฯยฒ")

mean_a = sum(a) / len(a)
gen_variance = (sum((x - mean_a)**2 for x in a)) / len(a)  # ะณะตะฝะตัะฐะปัะฝะฐั ะดะธัะฟะตััะธั
# ฯะฝะฐะฑะป^2 = (n-1)s^2/ฯ^2
# ๐ - ะฒัะฑะพัะพัะฝะฐั ะดะธัะฟะตััะธั, ฯ โ ะธะทะฒะตััะฝะฐั ะดะธัะฟะตััะธั ะณะตะฝะตัะฐะปัะฝะพะน ัะพะฒะพะบัะฟะฝะพััะธ
print(f"ะณะตะฝะตัะฐะปัะฝะฐั ัะพะฒะพะบัะฟะฝะพััั: {gen_variance}")

# ะัะฑะธัะฐะตะผ ะพะดะฝั ะธะท ะฒัะฑะพัะพะบ
sample = sample1
n = len(sample) # ัะฐะทะผะตั ะฒัะฑะพัะบะธ
alpha = 0.05

# ะกัะฐัะธััะธะบะฐ ฯยฒ
# ฯยฒ = (n-1)sยฒ/ฯยฒ
s2 = np.var(sample, ddof=1)  # ะฒัะฑะพัะพัะฝะฐั ะดะธัะฟะตััะธั ััะพะน ะฒัะฑะพัะบะธ
chi2_stat = (n - 1) * s2 / gen_variance
print(f"s^2 - ะฒัะฑะพัะพัะฝะฐั ะดะธัะฟ: {s2}")

print("\nะัะพะฒะตัะบะฐ ะณะธะฟะพัะตะทั ะพ ัะฐะฒะตะฝััะฒะต ะณะตะฝ. ะดะธัะฟะตััะธะธ ะธ ฯยฒ")
print(f"ฯยฒะฝะฐะฑะป = {chi2_stat:.4f}")

# a) H1: D > ฯยฒ
chi2_crit_right = stats.chi2.ppf(1 - alpha, n - 1) # ะดะฐัั ะบัะธัะธัะตัะบะพะต ะทะฝะฐัะตะฝะธะต ฯยฒ ะดะปั ะทะฐะดะฐะฝะฝะพะน ะฒะตัะพััะฝะพััะธ q ะธ df = n-1.
# ะะปั ะฟัะฐะฒะพััะพัะพะฝะฝะตะน ะฟัะพะฒะตัะบะธ ะฑะตััะผ ะฒะตััะฝัั ะณัะฐะฝะธัั 1 โ ฮฑ.

print(f"ะัะฐะฒะพััะพัะพะฝะฝัั ะฟัะพะฒะตัะบะฐ H1: D > ฯยฒ")
print(f"ฯยฒะบัะธั = {chi2_crit_right:.4f}")
if chi2_stat > chi2_crit_right:
    print('๐2 > ๐2ะบั')
    print("โ ะัะฒะตัะณะฐะตะผ H0: ะดะธัะฟะตััะธั ะฒัะฑะพัะบะธ ะฑะพะปััะต ฯยฒ")
else:
    print('๐2 < ๐2ะบั')
    print("โ ะะต ะพัะฒะตัะณะฐะตะผ H0: ะดะธัะฟะตััะธั ัะฐะฒะฝะฐ ฯยฒ")

# ะฑ) H1: D โ ฯยฒ
chi2_crit_lower = stats.chi2.ppf(alpha/2, n - 1)
chi2_crit_upper = stats.chi2.ppf(1 - alpha/2, n - 1)
print(f"\nะะฒัััะพัะพะฝะฝัั ะฟัะพะฒะตัะบะฐ H1: D โ ฯยฒ")
print(f"ะัะธัะธัะตัะบะฐั ะพะฑะปะฐััั: ฯยฒ < {chi2_crit_lower:.4f} ะธะปะธ ฯยฒ > {chi2_crit_upper:.4f}")

if chi2_stat < chi2_crit_lower or chi2_stat > chi2_crit_upper:
    print('๐2ะฝะฐะฑะป < ๐2ะบั1 ะธะปะธ ๐2ะฝะฐะฑะป > ๐2ะบั2')
    print("โ ะัะฒะตัะณะฐะตะผ H0: ะดะธัะฟะตััะธั ัะฐะทะปะธัะฐะตััั")
else:
    print('๐2ะบั1 < ๐2ะฝะฐะฑะป < ๐2ะบั2')
    print("โ ะะต ะพัะฒะตัะณะฐะตะผ H0: ะดะธัะฟะตััะธั ัะฐะฒะฝะฐ ฯยฒ")

# ะฒ) H1: D < ฯยฒ
chi2_crit_left = stats.chi2.ppf(alpha, n - 1)
print(f"\nะะตะฒะพััะพัะพะฝะฝัั ะฟัะพะฒะตัะบะฐ H1: D < ฯยฒ")
print(f"ฯยฒะบัะธั = {chi2_crit_left:.4f}")
if chi2_stat < chi2_crit_left:
    print('๐2ะฝะฐะฑะป < ๐2ะบั')
    print("โ ะัะฒะตัะณะฐะตะผ H0: ะดะธัะฟะตััะธั ะฒัะฑะพัะบะธ ะผะตะฝััะต ฯยฒ")
else:
    print('๐2ะฝะฐะฑะป > ๐2ะบั')
    print("โ ะะต ะพัะฒะตัะณะฐะตะผ H0: ะดะธัะฟะตััะธั ัะฐะฒะฝะฐ ฯยฒ")
