import math
import pandas as pd
from scipy import stats

with open("–ú–æ—Å–∫–≤–∞_2021.txt", 'r') as f:
    a = list(map(int, f))
groups = 7
interval = math.ceil((max(a) - min(a))/groups)
a.sort()
uniques = list(set(a))
discrete = []
for i in range(len(uniques)):
    age = uniques[i]
    count = a.count(uniques[i])
    probability = round(count/len(a), 3)
    frequency = count * probability
    discrete.append([age, count, frequency])
df = pd.DataFrame(discrete)
df.columns = ["–≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞", "–∫–æ–ª-–≤–æ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π", "—á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π"]
print(df)


corr_matrix = df[["–≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞", "—á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π"]].corr()
corr_matrix
r = corr_matrix.iloc[0, 1]

cov_matrix = round(df[["–≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞", "—á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π"]].cov(), 4)
print(f"""–º–∞—Ç—Ä–∏—Ü–∞ –∫–æ–≤–∞—Ä–∏–∞—Ü–∏–π:
      {cov_matrix}
""")
print(f"–∫–æ–≤–∞—Ä–∏–∞—Ü–∏—è: {round(cov_matrix.iloc[0, 1], 4)}\n")

std_x = df["–≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞"].std()
std_y = df["—á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π"].std()
print(f"—Å–∫–æ x: {round(std_x, 4)}")
print(f"—Å–∫–æ y: {round(std_y, 4)}\n")

print(f"–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ª–∏–Ω–µ–π–Ω–æ–π –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –≤–æ–∑—Ä–∞—Å—Ç–æ–º –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞ (X) –∏ —á–∞—Å—Ç–æ—Ç–æ–π —Å–æ–≤–µ—Ä—à–∞–µ–º—ã—Ö –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π (Y) = {round(r, 4)}\n")
print(f"–ø—Ä–æ–≤–µ—Ä–∏–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –ü–∏—Ä—Å–æ–Ω–∞:\n")

if r >= -1 and r <= 1:
    print("—Å–≤–æ–π—Å—Ç–≤–æ 1) ‚àí1 ‚â§ r ‚â§ 1 - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è")
else:
    print("—Å–≤–æ–π—Å—Ç–≤–æ 1) ‚àí1 ‚â§ r ‚â§ 1 - –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è")

if r != 0:
    print("—Å–≤–æ–π—Å—Ç–≤–æ 2) –ø—Ä–∏ r ‚â† 0 –≤–µ–ª–∏—á–∏–Ω—ã –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω—ã")
else:
    print("—Å–≤–æ–π—Å—Ç–≤–æ 2) –ø—Ä–∏ r = 0 –≤–µ–ª–∏—á–∏–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω—ã")

data_corr = df.copy()
data_corr * 2
data_corr + 10
data_corr_matrix = data_corr[["–≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞", "—á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π"]].corr()
if data_corr_matrix.iloc[0, 1] == r:
    print("—Å–≤–æ–π—Å—Ç–≤–æ 3) r –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –æ—Ç –ø—Ä–∏–±–∞–≤–ª–µ–Ω–∏—è –∫ —Ö –∏ —É –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö (–Ω–µ—Å–ª—É—á–∞–π–Ω—ã—Ö) —Å–ª–∞–≥–∞–µ–º—ã—Ö –∏ –æ—Ç —É–º–Ω–æ–∂–µ–Ω–∏—è —Ö –∏ —É –Ω–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è")
else:
    print("—Å–≤–æ–π—Å—Ç–≤–æ 3) r –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –æ—Ç –ø—Ä–∏–±–∞–≤–ª–µ–Ω–∏—è –∫ —Ö –∏ —É –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö (–Ω–µ—Å–ª—É—á–∞–π–Ω—ã—Ö) —Å–ª–∞–≥–∞–µ–º—ã—Ö –∏ –æ—Ç —É–º–Ω–æ–∂–µ–Ω–∏—è —Ö –∏ —É –Ω–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ - –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è")

if r > 0:
    print("—Å–≤–æ–π—Å–≤—Ç–æ 4) –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä—è–º—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å")
else:
    print("—Å–≤–æ–π—Å–≤—Ç–æ 4) –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ–±—Ä–∞—Ç–Ω—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å")

if 0 < abs(r) <= 0.3:
    print("—Å–≤–æ–π—Å—Ç–≤–æ 5) 0 < |r| ‚â§ 0,3 –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å–ª–∞–±–∞—è")
elif 0.3 < abs(r) <= 0.5:
    print("—Å–≤–æ–π—Å—Ç–≤–æ 6) –ø—Ä–∏ 0,3 < |r| ‚â§ 0,5 –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —É–º–µ—Ä–µ–Ω–Ω–∞—è")
elif 0.5 < abs(r) <= 0.7:
    print("—Å–≤–æ–π—Å—Ç–≤–æ 7) –ø—Ä–∏ 0,5 < |r| ‚â§ 0,7 –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∑–∞–º–µ—Ç–Ω–∞—è")
elif 0.7 < abs(r) < 1:
    print("—Å–≤–æ–π—Å—Ç–≤–æ 8) –ø—Ä–∏ 0,7 < |r| < 1 –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å–∏–ª—å–Ω–∞—è")
else:
    print("—Å–≤–æ–π—Å—Ç–≤–æ 9) –ø—Ä–∏ |r| = 1 –º–µ–∂–¥—É –≤–µ–ª–∏—á–∏–Ω–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å")


print("""–ø—Ä–æ–≤–µ—Ä–∏–º –Ω—É–ª–µ–≤—É—é –≥–∏–ø–æ—Ç–µ–∑—É –æ –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–æ—á–Ω–æ–≥–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏:
      –Ω—É–ª–µ–≤–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞ H0: ùúåxy = 0
      –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—â–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞ H1: ùúåxy ‚â† 0
      """)

alpha = 0.05
k = len(uniques) - 2
T = (r * math.sqrt(k)) / math.sqrt(1 - r**2)
print(f"–í –∫–∞—á–µ—Å—Ç–≤–µ –∫—Ä–∏—Ç–µ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω—É–ª–µ–≤–æ–π –≥–∏–ø–æ—Ç–µ–∑—ã –ø—Ä–∏–Ω–∏–º–µ–º —Å–ª—É—á–∞–π–Ω—É—é –≤–µ–ª–∏—á–∏–Ω—É T = {round(T, 5)}")

t_cr = stats.t.ppf(alpha, k)
print(f"t–∫—Ä = {round(t_cr, 4)}\n")
if abs(T) < t_cr:
    print(f"—Ç–∞–∫ –∫–∞–∫ |T–Ω–∞–±–ª| < t–Ω–∞–±–ª, –Ω–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏–π –æ—Ç–≤–µ—Ä–≥–Ω—É—Ç—å –Ω—É–ª–µ–≤—É—é –≥–∏–ø–æ—Ç–µ–∑—É")
else:
    print(f"—Ç–∞–∫ –∫–∞–∫ |T–Ω–∞–±–ª| > t–Ω–∞–±–ª, –Ω—É–Ω–µ–≤–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞ –æ—Ç–≤–µ—Ä–≥–∞–µ—Ç—Å—è")


import matplotlib.pyplot as plt

plt.figure(figsize=(20, 6))
plt.scatter(df["–≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞"], df["–∫–æ–ª-–≤–æ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π"])
plt.plot(df["–≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞"], df["–∫–æ–ª-–≤–æ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π"])
plt.xticks(df["–≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞"])

for i, row in df.iterrows():
    plt.annotate(f"({row['–≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞']}; {row["–∫–æ–ª-–≤–æ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π"]:.1f})", (row["–≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞"], row["–∫–æ–ª-–≤–æ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π"]), textcoords="offset points", xytext=(5, 5))

plt.xlabel("–≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞")
plt.ylabel("–∫–æ–ª-–≤–æ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π")
plt.title('–∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–µ –ø–æ–ª–µ')
plt.grid(True)
plt.savefig('images/corr4.png')
